pr: none
trigger:
- try

variables:
- group: prod-credentials

jobs:
    # - job: Linux
    #   timeoutInMinutes: 600
    #   pool:
    #     vmImage: ubuntu-16.04
    #   steps:
    #   - template: steps/run.yml
    #   strategy:
    #     matrix:
    #       dist-x86_64-linux: {}
    #       dist-x86_64-linux-alt:
    #         IMAGE: dist-x86_64-linux

# The macOS and Windows builds here are currently disabled due to them not being
# overly necessary on `try` builds. We also don't actually have anything that
# consumes the artifacts currently. Perhaps one day we can reenable, but for now
# it helps free up capacity on Azure.
# - job: macOS
#   timeoutInMinutes: 600
#   pool:
#     vmImage: macos-10.13
#   steps:
#   - template: steps/run.yml
#   strategy:
#     matrix:
#       dist-x86_64-apple:
#         SCRIPT: ./x.py dist
#         RUST_CONFIGURE_ARGS: --target=aarch64-apple-ios,armv7-apple-ios,armv7s-apple-ios,i386-apple-ios,x86_64-apple-ios --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc
#         DEPLOY: 1
#         RUSTC_RETRY_LINKER_ON_SEGFAULT: 1
#         MACOSX_DEPLOYMENT_TARGET: 10.7
#         NO_LLVM_ASSERTIONS: 1
#         NO_DEBUG_ASSERTIONS: 1
#         DIST_REQUIRE_ALL_TOOLS: 1
#
#       dist-x86_64-apple-alt:
#         SCRIPT: ./x.py dist
#         RUST_CONFIGURE_ARGS: --enable-extended --enable-profiler --set rust.jemalloc
#         DEPLOY_ALT: 1
#         RUSTC_RETRY_LINKER_ON_SEGFAULT: 1
#         MACOSX_DEPLOYMENT_TARGET: 10.7
#         NO_LLVM_ASSERTIONS: 1
#         NO_DEBUG_ASSERTIONS: 1
#
- job: Windows
  timeoutInMinutes: 600
  pool:
    vmImage: 'vs2017-win2016'
  steps:
  - template: steps/run.yml
  strategy:
    matrix:
      x86_64-mingw-1:
        SCRIPT: make ci-mingw-subset-1
        RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu
        CUSTOM_MINGW: 1
        # FIXME(#59637)
        NO_DEBUG_ASSERTIONS: 1
        NO_LLVM_ASSERTIONS: 1
#     x86_64-mingw-2:
#       SCRIPT: make ci-mingw-subset-2
#       RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu
#       CUSTOM_MINGW: 1
#     i686-mingw-1:
#       RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu
#       SCRIPT: make ci-mingw-subset-1
#       CUSTOM_MINGW: 1
#       # FIXME(#59637)
#       NO_DEBUG_ASSERTIONS: 1
#       NO_LLVM_ASSERTIONS: 1
      i686-mingw-2:
        RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu
        SCRIPT: make ci-mingw-subset-2
        CUSTOM_MINGW: 1
#      dist-i686-mingw:
#        RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu --enable-full-tools --enable-profiler
#        SCRIPT: python x.py dist
#        CUSTOM_MINGW: 1
#        DIST_REQUIRE_ALL_TOOLS: 1
